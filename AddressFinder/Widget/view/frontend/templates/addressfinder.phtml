<script>
  // MAGENTO v2
  //   #street_1 // account
  //   [name=street[0]] // shipping checkout
  //   [name=street[1]]
  //   [name=street[0]] // billing checkout
  //   [name=street[1]]

  /** billing & shipping
    UNDER: .billing-address-form & .form-shipping-address

    name=street[0]
    name=street[1]
    name=city
    name=region_id (state/province)
    name=postcode
    name=country_id
  **/

  require(['domReady!'], function(){

    (function() {
      var currentUrl = location.href;

      function usingKnockout(){
        return !!document.querySelector('[data-bind]');
      };

      function knockoutLoaded(){
        return !!document.querySelector('[data-bind]:last-child').innerText.trim().length;
      };

      function watchUrl(){
        console.log('watching url');
        if (location.href != currentUrl) {
          currentUrl = location.href;
          setTimeout(initAF, 500);
        } else {
          setTimeout(watchUrl, 1000);
        }
      };

      function initAF(){
        console.log('initializing');

        var inputs = document.querySelectorAll("input[name*=street]")
        console.log(inputs.length + ' street inputs')

        // var widget = new AddressFinder.Widget(document.querySelector("input[name='street[0]']"), 'ADDRESSFINDER_AU_DEMO_KEY', 'AU', {});

        if (!!currentUrl.match(/\/checkout/i)){ watchUrl(); };
      };

      function loadAF(){
        var inputs = document.querySelectorAll("input[name*=street]")
        if (inputs.length){
          initAF();
          // var script = document.createElement('script');
          // script.src = '//api.addressfinder.io/assets/v3/widget.js';
          // script.async = true;
          // script.onload = initAF;
          // document.body.appendChild(script);
        };
      };

      function start(){
        if (usingKnockout() && !knockoutLoaded()){
          setTimeout(start, 2000);
        } else {
          loadAF();
        };
      };

      start();

    })();

  });
</script>