var bind=function(t,e){return function(){return t.apply(e,arguments)}};define(function(){var t;return t=function(){function t(t,e,i,s,n){this.addressLine1Element=t,this.mappings=e,this.licenceKey=i,this.debugMode=s,this.widgetOptions=n,this.populate=bind(this.populate,this),this.setCountry=bind(this.setCountry,this),this.disable=bind(this.disable,this),this.setupCountrySwitcher=bind(this.setupCountrySwitcher,this),this.setupWidgets=bind(this.setupWidgets,this),this.countries=bind(this.countries,this),this.getFormElement=bind(this.getFormElement,this),this.countryElement=this.getFormElement("country"),null!=this.countryElement&&(this.addressLine2Element=this.getFormElement("addressLine2"),this.cityElement=this.getFormElement("city"),this.regionElement=this.getFormElement("region"),this.postcodeElement=this.getFormElement("postcode"),this.setupWidgets(),this.setupCountrySwitcher())}return t.prototype.getFormElement=function(t){return this.addressLine1Element.form.querySelector(this.mappings[t])},t.prototype.countries=function(){var t;return this._countries||(this._countries=function(){var e,i,s,n;for(n=[],e=0,i=(s=this.countryElement.options).length;e<i;e++)t=s[e],n.push(t.value);return n}.call(this))},t.prototype.setupWidgets=function(){if(this.countries().indexOf("AU")&&(this.au=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"AU",this.widgetOptions),this.au.on("result:select",this.populate)),this.countries().indexOf("NZ"))return this.nz=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"NZ",this.widgetOptions),this.nz.on("result:select",this.populate)},t.prototype.setupCountrySwitcher=function(){return this.setCountry(),this.countryElement.addEventListener("change",this.setCountry)},t.prototype.disable=function(){if(null!=this.au&&this.au.disable(),null!=this.nz)return this.nz.disable()},t.prototype.setCountry=function(){switch(this.disable(),this.countryElement.value){case"AU":if(this.debugMode&&console.debug("Enabling AU"),null!=this.au)return this.au.enable();break;case"NZ":if(this.debugMode&&console.debug("Enabling NZ"),null!=this.nz)return this.nz.enable()}},t.prototype.populate=function(t,e){var i;return this.au.enabled?(this.addressLine1Element.value=e.address_line_1,this.addressLine2Element.value=e.address_line_2,this.cityElement.value=e.locality_name,this.regionElement.value=e.state_territory,this.postcodeElement.value=e.postcode):this.nz.enabled?(i=new AddressFinder.NZSelectedAddress(e.a,e),this.addressLine1Element.value=i.address_line_1_and_2(),this.addressLine2Element.value=e.suburb,this.cityElement.value=e.city,this.regionElement.value=e.region,this.postcodeElement.value=e.postcode):void 0},t}(),function(){function e(t){this.initAF=bind(this.initAF,this),this.watchUrl=bind(this.watchUrl,this),this.foundAddressFields=bind(this.foundAddressFields,this),this.parseWidgetOptions=bind(this.parseWidgetOptions,this),this.start=bind(this.start,this),this.debugMode=t.debugMode||!1,this.checkoutMode=t.checkoutMode||!1,this.licenceKey=t.licenceKey,this.fieldMappings=t.fieldMappings||{},this.widgetOptions=this.parseWidgetOptions(t.widgetOptions),this.currentUrl=window.location.href}return e.prototype.start=function(){return this.checkoutMode&&!this.foundAddressFields()?(this.debugMode&&console.debug("Waiting for knockout"),setTimeout(this.start,1e3)):(this.debugMode&&(console.debug("Licence key: "+this.licenceKey),console.debug("Widget options:",this.widgetOptions)),this.checkoutMode&&this.watchUrl(),this.initAF())},e.prototype.parseWidgetOptions=function(t){try{return JSON.parse(t)}catch(t){return this.debugMode&&console.warn("Widget options ignored. They must be in valid JSON format"),{}}},e.prototype.foundAddressFields=function(){return!!document.querySelectorAll(Object.keys(this.fieldMappings).join(", ")).length},e.prototype.watchUrl=function(){return this.debugMode&&console.debug("Watching url"),window.location.href!==this.currentUrl?(this.currentUrl=window.location.href,setTimeout(this.initAF,500)):setTimeout(this.watchUrl,1e3)},e.prototype.initAF=function(){var e,i,s,n,o;n=this.fieldMappings,o=[];for(i in n)s=n[i],e=document.querySelector(i),o.push(new t(e,s,this.licenceKey,this.debugMode,this.widgetOptions));return o},e}()});