var bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){for(var i in e)hasProp.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;define(function(){var i;return(i={}).Page=function(){function t(t){this._widgetNeedsInit=bind(this._widgetNeedsInit,this),this._initWidget=bind(this._initWidget,this),this._parseWidgetOptions=bind(this._parseWidgetOptions,this),this.start=bind(this.start,this),this.debugMode=t.debugMode||!1,this.licenceKey=t.licenceKey,this.fieldMappings=t.fieldMappings||{},this.widgetOptions=this._parseWidgetOptions(t.widgetOptions),this.attachToParent=t.attachToParent,this.widgets=[],this.debugMode&&(console.debug("Licence key: "+this.licenceKey),console.debug("Widget options:",this.widgetOptions))}return t.prototype.start=function(){var t,e,i;for(i in e=[],t=this.fieldMappings)t[i],e.push(this._initWidget(i));return e},t.prototype._parseWidgetOptions=function(t){try{return JSON.parse(t)}catch(t){return this.debugMode&&console.warn("Widget options ignored. They must be in valid JSON format"),{}}},t.prototype._initWidget=function(t){var e;if(null!=(e=document.querySelector(t))&&this._widgetNeedsInit(e))return this.attachToParent&&(this.widgetOptions.container=e.parentElement,e.parentElement.style.position="relative",this.debugMode&&console.debug("Widget options:",this.widgetOptions)),this.widgets.push(new i.Widget(t,e,this.fieldMappings[t],this.licenceKey,this.debugMode,this.widgetOptions))},t.prototype._widgetNeedsInit=function(t){var e,i,n;for(e=0,i=(n=this.widgets).length;e<i;e++)if(n[e].addressLine1Element===t)return!1;return!0},t}(),i.Checkout=function(t){function e(t){this._watchUrl=bind(this._watchUrl,this),this.start=bind(this.start,this),this.currentUrl=window.location.href,e.__super__.constructor.call(this,t)}return extend(e,t),e.prototype.start=function(){return this._foundAddressFields()?(e.__super__.start.apply(this,arguments),this._watchUrl()):(this.debugMode&&console.debug("Waiting for knockout"),void setTimeout(this.start,500))},e.prototype._foundAddressFields=function(){var t;return t=Object.keys(this.fieldMappings),window.location.href.match(/checkout\/#payment$/)?document.querySelectorAll(t).length===t.length:document.querySelectorAll(t).length},e.prototype._watchUrl=function(){return window.location.href!==this.currentUrl?(this.debugMode&&console.debug("Url changed"),this.currentUrl=window.location.href,setTimeout(this.start,500)):(this.debugMode&&console.debug("Watching url"),setTimeout(this._watchUrl,1e3))},e}(i.Page),i.Widget=function(){function t(t,e,i,n,s,o){this.name=t,this.addressLine1Element=e,this.mappings=i,this.licenceKey=n,this.debugMode=s,this.widgetOptions=o,this.populate=bind(this.populate,this),this.setCountry=bind(this.setCountry,this),this.disable=bind(this.disable,this),this.setupCountrySwitcher=bind(this.setupCountrySwitcher,this),this.setupWidgets=bind(this.setupWidgets,this),this.countries=bind(this.countries,this),this.getFormElement=bind(this.getFormElement,this),this.countryElement=this.getFormElement("country"),null!=this.countryElement&&(this.addressLine2Element=this.getFormElement("addressLine2"),this.cityElement=this.getFormElement("city"),this.regionElement=this.getFormElement("region"),this.postcodeElement=this.getFormElement("postcode"),this.setupWidgets(),this.setupCountrySwitcher())}return t.prototype.getFormElement=function(t){return this.addressLine1Element.form.querySelector(this.mappings[t])},t.prototype.countries=function(){var s;return this._countries||(this._countries=function(){var t,e,i,n;for(n=[],t=0,e=(i=this.countryElement.options).length;t<e;t++)s=i[t],n.push(s.value);return n}.call(this))},t.prototype.setupWidgets=function(){if(this.countries().indexOf("AU")&&(this.au=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"AU",this.widgetOptions),this.au.on("result:select",this.populate)),this.countries().indexOf("NZ"))return this.nz=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"NZ",this.widgetOptions),this.nz.on("result:select",this.populate)},t.prototype.setupCountrySwitcher=function(){return this.setCountry(),this.countryElement.addEventListener("change",this.setCountry)},t.prototype.disable=function(){if(null!=this.au&&this.au.disable(),null!=this.nz)return this.nz.disable()},t.prototype.setCountry=function(){switch(this.disable(),this.countryElement.value){case"AU":if(this.debugMode&&console.debug("Enabling AU on "+this.name),null!=this.au)return this.au.enable();break;case"NZ":if(this.debugMode&&console.debug("Enabling NZ on "+this.name),null!=this.nz)return this.nz.enable()}},t.prototype.populate=function(t,e){var i;return this.au.enabled?(this.addressLine1Element.value=e.address_line_1,this.addressLine2Element.value=e.address_line_2,this.cityElement.value=e.locality_name,this.regionElement.value=e.state_territory,this.postcodeElement.value=e.postcode):this.nz.enabled&&(i=new AddressFinder.NZSelectedAddress(e.a,e),this.addressLine1Element.value=i.address_line_1_and_2(),this.addressLine2Element.value=e.suburb,this.cityElement.value=e.city,this.regionElement.value=e.region,this.postcodeElement.value=e.postcode),this.addressLine1Element.dispatchEvent(new Event("change")),this.addressLine2Element.dispatchEvent(new Event("change")),this.cityElement.dispatchEvent(new Event("change")),this.regionElement.dispatchEvent(new Event("change")),this.postcodeElement.dispatchEvent(new Event("change"))},t}(),i});