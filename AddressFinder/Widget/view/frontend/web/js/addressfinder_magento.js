var bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;define(function(){var t;return t={},t.Page=function(){function e(t){this._widgetNeedsInit=bind(this._widgetNeedsInit,this),this._initWidget=bind(this._initWidget,this),this._parseWidgetOptions=bind(this._parseWidgetOptions,this),this.start=bind(this.start,this),this.debugMode=t.debugMode||!1,this.licenceKey=t.licenceKey,this.fieldMappings=t.fieldMappings||{},this.widgetOptions=this._parseWidgetOptions(t.widgetOptions),this.widgets=[],this.debugMode&&(console.debug("Licence key: "+this.licenceKey),console.debug("Widget options:",this.widgetOptions))}return e.prototype.start=function(){var t,e,i;t=this.fieldMappings,e=[];for(i in t)t[i],e.push(this._initWidget(i));return e},e.prototype._parseWidgetOptions=function(t){try{return JSON.parse(t)}catch(t){return this.debugMode&&console.warn("Widget options ignored. They must be in valid JSON format"),{}}},e.prototype._initWidget=function(e){var i;if(null!=(i=document.querySelector(e))&&this._widgetNeedsInit(i))return this.widgets.push(new t.Widget(e,i,this.fieldMappings[e],this.licenceKey,this.debugMode,this.widgetOptions))},e.prototype._widgetNeedsInit=function(t){var e,i,n;for(e=0,i=(n=this.widgets).length;e<i;e++)if(n[e].addressLine1Element===t)return!1;return!0},e}(),t.Checkout=function(t){function e(t){this._watchUrl=bind(this._watchUrl,this),this.start=bind(this.start,this),this.currentUrl=window.location.href,e.__super__.constructor.call(this,t)}return extend(e,t),e.prototype.start=function(){return this._foundAddressFields()?(e.__super__.start.apply(this,arguments),this._watchUrl()):(this.debugMode&&console.debug("Waiting for knockout"),void setTimeout(this.start,500))},e.prototype._foundAddressFields=function(){var t;return t=Object.keys(this.fieldMappings),window.location.href.match(/checkout\/#payment$/)?document.querySelectorAll(t).length===t.length:document.querySelectorAll(t).length},e.prototype._watchUrl=function(){return window.location.href!==this.currentUrl?(this.debugMode&&console.debug("Url changed"),this.currentUrl=window.location.href,setTimeout(this.start,500)):(this.debugMode&&console.debug("Watching url"),setTimeout(this._watchUrl,1e3))},e}(t.Page),t.Widget=function(){function t(t,e,i,n,s,r){this.name=t,this.addressLine1Element=e,this.mappings=i,this.licenceKey=n,this.debugMode=s,this.widgetOptions=r,this.populate=bind(this.populate,this),this.setCountry=bind(this.setCountry,this),this.disable=bind(this.disable,this),this.setupCountrySwitcher=bind(this.setupCountrySwitcher,this),this.setupWidgets=bind(this.setupWidgets,this),this.countries=bind(this.countries,this),this.getFormElement=bind(this.getFormElement,this),this.countryElement=this.getFormElement("country"),null!=this.countryElement&&(this.addressLine2Element=this.getFormElement("addressLine2"),this.cityElement=this.getFormElement("city"),this.regionElement=this.getFormElement("region"),this.postcodeElement=this.getFormElement("postcode"),this.setupWidgets(),this.setupCountrySwitcher())}return t.prototype.getFormElement=function(t){return this.addressLine1Element.form.querySelector(this.mappings[t])},t.prototype.countries=function(){var t;return this._countries||(this._countries=function(){var e,i,n,s;for(s=[],e=0,i=(n=this.countryElement.options).length;e<i;e++)t=n[e],s.push(t.value);return s}.call(this))},t.prototype.setupWidgets=function(){if(this.countries().indexOf("AU")&&(this.au=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"AU",this.widgetOptions),this.au.on("result:select",this.populate)),this.countries().indexOf("NZ"))return this.nz=new AddressFinder.Widget(this.addressLine1Element,this.licenceKey,"NZ",this.widgetOptions),this.nz.on("result:select",this.populate)},t.prototype.setupCountrySwitcher=function(){return this.setCountry(),this.countryElement.addEventListener("change",this.setCountry)},t.prototype.disable=function(){if(null!=this.au&&this.au.disable(),null!=this.nz)return this.nz.disable()},t.prototype.setCountry=function(){switch(this.disable(),this.countryElement.value){case"AU":if(this.debugMode&&console.debug("Enabling AU on "+this.name),null!=this.au)return this.au.enable();break;case"NZ":if(this.debugMode&&console.debug("Enabling NZ on "+this.name),null!=this.nz)return this.nz.enable()}},t.prototype.populate=function(t,e){var i;return this.au.enabled?(this.addressLine1Element.value=e.address_line_1,this.addressLine2Element.value=e.address_line_2,this.cityElement.value=e.locality_name,this.regionElement.value=e.state_territory,this.postcodeElement.value=e.postcode):this.nz.enabled&&(i=new AddressFinder.NZSelectedAddress(e.a,e),this.addressLine1Element.value=i.address_line_1_and_2(),this.addressLine2Element.value=e.suburb,this.cityElement.value=e.city,this.regionElement.value=e.region,this.postcodeElement.value=e.postcode),this.addressLine1Element.dispatchEvent(new Event("change")),this.addressLine2Element.dispatchEvent(new Event("change")),this.cityElement.dispatchEvent(new Event("change")),this.regionElement.dispatchEvent(new Event("change")),this.postcodeElement.dispatchEvent(new Event("change"))},t}(),t});