version: '2'

volumes:
  appdata-mage21-php56:
  dbdata-mage21-php56:

services:
  app:
    image: mageinferno/magento2-nginx:1.11-1
    links:
      - phpfpm
      - db
    volumes:
      - appdata-mage21-php56:/var/www/html
      - ./.composer:/var/www/.composer
      - ./AddressFinder:/var/www/html/app/code/AddressFinder
    ports:
      - 8000:80

  phpfpm:
    image: mageinferno/magento2-php:5.6.23-fpm-3
    links:
      - db
    volumes:
      - appdata-mage21-php56:/var/www/html
      - appdata-mage21-php56:/srv/www
      - ./.composer:/var/www/.composer
      - ./AddressFinder:/var/www/html/app/code/AddressFinder
      - ./AddressFinder:/srv/www/app/code/AddressFinder

  db:
    image: mariadb:10.1
    volumes:
      - dbdata-mage21-php56:/var/lib/mysql
    ports:
      - 8001:3306
    env_file: .docker/mysql.env

  setup:
    image: mageinferno/magento2-php:5.6.23-fpm-3
    command: /usr/local/bin/mage-setup
    links:
      - db
    volumes:
      - appdata-mage21-php56:/srv/www
      - ./.composer:/var/www/.composer
    environment:
      - M2SETUP_VERSION=2.1.14
    env_file: .docker/setup.env
